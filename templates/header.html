<header
    class="d-flex flex-wrap align-items-center justify-content-center justify-content-md-between py-3">
    <a href="/" class="d-flex align-items-center col-md-3 mb-2 mb-md-0 text-dark text-decoration-none header-logo-link">
        {% load static %}
        <img src="{% static "pithia-logo.png" %}" alt="PITHIA-NRF e-Science Centre" class="header-logo">
        <div class="d-flex flex-column g-1">
            <span class="fs-4">PITHIA-NRF</span>
            <div class="fs-6">e-Science Centre</div>
        </div>
    </a>

    <ul class="nav col-12 col-md-auto mb-2 justify-content-center mb-md-0">
        <li class="nav-item">
            {% url 'home' as base_url %}
            <a href="{{ base_url }}" class="nav-link px-2 {% if request.path == base_url %}link-secondary{% endif %}"
                aria-current="page">Home</a>
        </li>
        <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle"
                data-bs-toggle="dropdown" href="#" role="button"
                aria-expanded="false">Scientific Metadata</a>
            <ul class="dropdown-menu">
                <li>
                    {% url 'search:index' as search_url %}
                    <a href="{{ search_url }}" class="dropdown-item {% if request.path == search_url %}link-secondary{% endif %}">Search Data Collections with Ontology</a>
                </li>
                <li>
                    {% url 'browse:list_data_collections' as data_collections_url %}
                    <a href="{{ data_collections_url }}" class="dropdown-item {% if request.path == data_collections_url %}link-secondary{% endif %}">Browse Data Collections</a>
                </li>
                <li>
                    {% url 'browse:catalogue_related_resource_types' as catalogues_url %}
                    <a href="{{ catalogues_url }}" class="dropdown-item {% if request.path == catalogues_url %}link-secondary{% endif %}">Browse Catalogues</a>
                </li>
                <li>
                    {% url 'browse:index' as browse_url %}
                    <a href="{{ browse_url }}" class="dropdown-item {% if request.path == browse_url %}link-secondary{% endif %}">Browse Metadata</a>
                </li>
            </ul>
        </li>
        <li class="nav-item">
            {% url 'ontology:index' as browse_ontology_url %}
            <a href="{{ browse_ontology_url }}" class="nav-link px-2 {% if request.path == browse_ontology_url %}link-secondary{% endif %}">
                Space Physics Ontology
            </a>
        </li>
    </ul>
    <div class="col-md-3 text-end">
        {% if request.session.is_logged_in %}
        <div class="dropdown user-menu">
            <a class="link-body-emphasis text-decoration-none dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                {{ request.session.user_given_name }}
            </a>
            <div class="dropdown-menu">
                {% if request.session.institution_for_login_session %}
                <div class="row px-4 py-3">
                    {% if request.session.user_institution_subgroups|length > 1 %}
                    <div class="col-12">
                        <form action="{% url 'choose_institution_for_login_session' %}?next={{ request.path }}" method="POST">
                            {% csrf_token %}
                            <label
                                for="{{ request.institution_selection_form.institutions.auto_id }}"
                                class="fs-5 mb-1 text-secondary">
                                {{ request.institution_selection_form.institutions.label }}
                            </label>
                            <select
                                name="{{ request.institution_selection_form.institutions.name }}"
                                id="{{ request.institution_selection_form.institutions.auto_id }}"
                                class="form-select mb-2"
                                required="{{ request.institution_selection_form.institutions.required }}">
                                <option value="" disabled selected>
                                    {{ request.institution_selection_form.fields.institutions.choices|length|add:-1 }} others available...
                                </option>
                                {% for value, text in request.institution_selection_form.fields.institutions.choices %}
                                {% if request.session.institution_for_login_session != text %}
                                <option value="{{ value }}">{{ text }}</option>
                                {% endif %}
                                {% endfor %}
                            </select>
                            {{ request.institution_selection_form.next }}
                            <button href="#" type="submit" class="btn btn-primary mb-4">
                                Switch
                            </button>
                            <small class="institution-for-login-session d-block"><b>Currently logged in with</b> {{ request.session.institution_for_login_session }}</small>
                        </form>
                    </div>
                    {% endif %}
                </div>
                {% comment %} {% if request.session.institution_for_login_session %}
                <hr class="dropdown-divider">
                <b class="dropdown-header">Current Institution Management</b>
                <p class="dropdown-header">
                    Scientific Metadata Registrations
                </p>
                {% url 'resource_management:index' as resource_management_url %}
                <a href="{{ resource_management_url }}" class="dropdown-item {% if request.path == resource_management_url %}link-secondary{% endif %}">
                    Manage Registrations
                </a>
                <a href="https://docs.google.com/document/d/1NK-YcZQZZju62_YC7mXFVZrkLFplEYFuaKKSet9uhJY/edit#" class="dropdown-item" target="_blank">
                    View Metadata Registration Guide
                </a>
                <li>
                    {% url 'schemas' as browse_schemas_url %}
                    <a href="{{ browse_schemas_url }}" class="dropdown-item {% if request.path == browse_schemas_url %}link-secondary{% endif %}">
                        View Metadata Models
                    </a>
                </li>
                {% endif %}
                <hr class="dropdown-divider">
                <p class="dropdown-header">My Institutions</p>
                <a href="{{ create_institution_url }}" class="dropdown-item">
                    Register a New Institution
                </a>
                <a href="{{ join_an_institution_url }}" class="dropdown-item">
                    Join Another Institution
                </a> {% endcomment %}
                <hr class="dropdown-divider">
                {% endif %}
                <form action="{% url 'logout' %}" method="POST">
                    {% csrf_token %}
                    <button href="#" type="submit" class="dropdown-item logout-button">
                        <img src="{% static 'logout.svg' %}" alt="Logout" class="me-1">
                        Logout
                    </button>
                </form>
            </div>
        </div>
        {% else %}
        <a href="{% url 'data_provider_home' %}" class="btn btn-outline-primary me-2">
            Login/Sign up
        </a>
        {% endif %}
    </div>
</header>
