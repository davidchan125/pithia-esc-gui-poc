<header
    class="d-flex flex-wrap align-items-center justify-content-center justify-content-md-between py-3">
    <a href="/" class="d-flex align-items-center col-md-3 mb-2 mb-md-0 text-dark text-decoration-none header-logo-link">
        {% load static %}
        <img src="{% static "pithia-logo.png" %}" alt="PITHIA-NRF e-Science Centre" class="header-logo">
        <div class="d-flex flex-column g-1">
            <span class="fs-4">PITHIA-NRF</span>
            <div class="fs-6">e-Science Centre</div>
        </div>
    </a>

    <ul class="nav col-12 col-md-auto mb-2 justify-content-center mb-md-0">
        <li class="nav-item">
            {% url 'home' as base_url %}
            <a href="{{ base_url }}" class="nav-link px-2 {% if request.path == base_url %}link-secondary{% endif %}"
                aria-current="page">Home</a>
        </li>
        <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" data-bs-toggle="dropdown" href="#" role="button"
                aria-expanded="false">Search & Browse</a>
            <ul class="dropdown-menu">
                <li>
                    {% url 'search:index' as search_url %}
                    <a href="{{ search_url }}" class="dropdown-item {% if request.path == search_url %}link-secondary{% endif %}">Search Data Collections</a>
                </li>
                <li>
                    {% url 'browse:list_data_collections' as data_collections_url %}
                    <a href="{{ data_collections_url }}" class="dropdown-item {% if request.path == data_collections_url %}link-secondary{% endif %}">Browse Data Collections</a>
                </li>
                <li>
                    {% url 'browse:catalogue_related_resource_types' as catalogues_url %}
                    <a href="{{ catalogues_url }}" class="dropdown-item {% if request.path == catalogues_url %}link-secondary{% endif %}">Browse Catalogues</a>
                </li>
                <li>
                    {% url 'browse:index' as browse_url %}
                    <a href="{{ browse_url }}" class="dropdown-item {% if request.path == browse_url %}link-secondary{% endif %}">Browse Metadata</a>
                </li>
                <li>
                    {% url 'ontology:index' as browse_ontology_url %}
                    <a href="{{ browse_ontology_url }}" class="dropdown-item {% if request.path == browse_ontology_url %}link-secondary{% endif %}">Space Physics Ontology</a>
                </li>
            </ul>
        </li>
        {% if request.session.institution_for_login_session %}
        <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" data-bs-toggle="dropdown" href="#" role="button"
                aria-expanded="false">Admin
            </a>
            <ul class="dropdown-menu">
                <li>
                    {% url 'data_provider_home' as data_provider_home_url %}
                    <a href="{{ data_provider_home_url }}" class="dropdown-item {% if request.path == resource_management_url %}link-secondary{% endif %}">Dashboard</a>
                </li>
                <li>
                    <span class="dropdown-header">
                        Register & Manage Metadata
                    </span>
                </li>
                <li>
                    {% url 'resource_management:index' as resource_management_url %}
                    <a href="{{ resource_management_url }}" class="dropdown-item {% if request.path == resource_management_url %}link-secondary{% endif %}">Register & Manage Metadata</a>
                </li>
                <li>
                    <a href="https://docs.google.com/document/d/1NK-YcZQZZju62_YC7mXFVZrkLFplEYFuaKKSet9uhJY/edit#" class="dropdown-item" target="_blank">Metadata Registration Guide</a>
                </li>
                <li>
                    <span class="dropdown-header">
                        Browse
                    </span>
                </li>
                <li>
                    {% url 'schemas' as browse_schemas_url %}
                    <a href="{{ browse_schemas_url }}" class="dropdown-item {% if request.path == browse_schemas_url %}link-secondary{% endif %}">Metadata Models</a>
                </li>
            </ul>
        </li>
        {% endif %}
    </ul>

    <div class="col-md-3 text-end">
        {% if request.session.is_logged_in %}
        <div class="dropdown user-menu">
            <a class="link-body-emphasis text-decoration-none dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                {{ request.session.user_given_name }}
            </a>
            <div class="dropdown-menu">
                {% if request.session.institution_for_login_session %}
                <p class="dropdown-header">Current Institution</p>
                <div class="row px-3 pb-2 gy-3">
                    <div class="col-12">
                        <small class="institution-for-login-session text-secondary fw-bold">{{ request.session.institution_for_login_session }}</small>
                    </div>
                    {% if request.session.user_institution_subgroups|length > 1 %}
                    <div class="col-12">
                        <form action="{% url 'set_institution_for_login_session' %}?next={{ request.path }}" method="POST">
                            {% csrf_token %}
                            <label for="{{ request.institution_selection_form.institutions.auto_id }}">
                                Change to:
                            </label>
                            <select
                                name="{{ request.institution_selection_form.institutions.name }}"
                                id="{{ request.institution_selection_form.institutions.auto_id }}"
                                class="form-select mb-3">
                                {% for value, text in request.institution_selection_form.fields.institutions.choices %}
                                    <option value="{{ value }}" {% if request.session.institution_for_login_session == text %}selected{% endif %}>{{ text }}</option>
                                {% endfor %}
                            </select>
                            <button href="#" type="submit" class="btn btn-primary">
                                Submit
                            </button>
                        </form>
                    </div>
                    {% endif %}
                </div>
                <hr class="dropdown-divider">
                {% endif %}
                <form action="{% url 'logout' %}" method="POST">
                    {% csrf_token %}
                    <button href="#" type="submit" class="dropdown-item">
                        Logout
                    </button>
                </form>
            </div>
        </div>
        {% else %}
        <a href="{% url 'set_institution_for_login_session' %}" class="btn btn-outline-primary me-2">
            Login
        </a>
        {% endif %}
    </div>
</header>
