{% extends 'base.html' %}
{% load static %}
{% block content %}
<h1>{{ title }}</h1>
{% if request.session.is_logged_in and not request.session.institution_for_login_session %}
<div class="row">
    <div class="col-lg-12">
        <div class="alert alert-{% if not request.session.user_institution_subgroups %}light{% else %}primary{% endif %} alert-institution-setting mt-3">
            <div class="row">
                <div class="col-lg-7">
                    {% if not request.session.user_institution_subgroups %}
                    <div class="p-md-3">
                        <p class="mb-4">
                            Register or join your institution's e-Science Centre
                            group to enable content management features for
                            this account.
                        </p>
                        <div class="d-flex flex-wrap justify-content-lg-start justify-content-center">
                            <a href="{% url 'list_joinable_perun_organisations' %}" class="btn btn-primary mx-1 ms-lg-0 me-lg-1 my-1">
                                Join an Existing Institution
                            </a>
                            <a href="{{ create_institution_url }}" class="btn btn-secondary mx-1 ms-lg-1 me-lg-0 my-1">
                                Register a New Institution
                            </a>
                        </div>
                    </div>
                    {% else %}
                    <div class="p-md-2 d-flex align-items-start">
                        <div class="me-2">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-file-earmark-arrow-up-fill" viewBox="0 0 16 16">
                                <path d="M9.293 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V4.707A1 1 0 0 0 13.707 4L10 .293A1 1 0 0 0 9.293 0zM9.5 3.5v-2l3 3h-2a1 1 0 0 1-1-1zM6.354 9.854a.5.5 0 0 1-.708-.708l2-2a.5.5 0 0 1 .708 0l2 2a.5.5 0 0 1-.708.708L8.5 8.707V12.5a.5.5 0 0 1-1 0V8.707L6.354 9.854z"/>
                            </svg>
                        </div>
                        <div>
                            <p>
                                Select which institution you would like to set for this login session (this can be changed later from the
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-person-circle" viewBox="0 0 16 16">
                                    <path d="M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0z"/>
                                    <path fill-rule="evenodd" d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8zm8-7a7 7 0 0 0-5.468 11.37C3.242 11.226 4.805 10 8 10s4.757 1.225 5.468 2.37A7 7 0 0 0 8 1z"/>
                                </svg> menu).
                            </p>
                            <form action="{% url 'choose_institution_for_login_session' %}" method="POST">
                                {% csrf_token %}
                                <label for="{{ request.institution_selection_form.institutions.auto_id }}">Institutions:</label>
                                <select
                                    name="{{ request.institution_selection_form.institutions.name }}"
                                    id="{{ request.institution_selection_form.institutions.auto_id }}"
                                    class="form-select"
                                    required="{{ request.institution_selection_form.institutions.required }}">
                                    <option value="" disabled selected>
                                        Member of {{ request.institution_selection_form.fields.institutions.choices|length }} institutions...
                                    </option>
                                    {% for value, text in request.institution_selection_form.fields.institutions.choices %}
                                    <option value="{{ value }}">{{ text }}</option>
                                    {% endfor %}
                                </select>
                                <small class="form-text d-block mb-3">Data management features will be enabled for the chosen institution.</small>
                                <button type="submit" class="btn btn-primary">Edit with this institution</button>
                            </form>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
<hr>
{% endif %}
<section>
    <h2 class="mb-3">Scientific Metadata</h2>
    <div class="card-menu mb-2">
        <div class="card">
            <div class="card-body">
                <a href="{% url 'search:index' %}">
                    <img src="{% static 'search.svg' %}" alt="Search">
                    <span>Search Data Collections</span>
                </a>
            </div>
        </div>
        <div class="card">
            <div class="card-body">
                <a href="{% url 'browse:index' %}">
                    <img src="{% static 'browse.svg' %}" alt="Browse">
                    <span>All Scientific Metadata</span>
                </a>
            </div>
        </div>
        <div class="card">
            <div class="card-body">
                <a href="{% url 'browse:list_data_collections' %}">
                    <img src="{% static 'browse.svg' %}" alt="Browse">
                    <span>Data Collections</span>
                </a>
            </div>
        </div>
        <div class="card">
            <div class="card-body">
                <a href="{% url 'browse:catalogue_related_resource_types' %}">
                    <img src="{% static 'browse.svg' %}" alt="Browse">
                    <span>Catalogues</span>
                </a>
            </div>
        </div>
    </div>
</section>
<hr>
<section>
    <h2 class="mb-3">Space Physics Ontology</h2>
    <div class="card-menu mb-2">
        <div class="card">
            <div class="card-body">
                <a href="{% url 'ontology:index' %}">
                    <img src="{% static 'ontology.svg' %}" alt="Ontology">
                    <span>Space Physics Ontology</span>
                </a>
            </div>
        </div>
        <div class="card">
            <div class="card-body">
                <a href="{% url 'ontology:guide' %}">
                    <img src="{% static 'ontology.svg' %}" alt="Ontology">
                    <span>Space Physics Ontology Guide</span>
                </a>
            </div>
        </div>
    </div>
</section>
<hr>
{% if request.session.institution_for_login_session %}
<h2 id="current-institution-management">{{ request.session.institution_for_login_session }}</h2>
<section>
    <h3 class="text-secondary mb-3">Data Registration</h3>
    <div class="card-menu mb-2">
{% else %}
<h2>Data Registration</h2>
<section>
    <div class="card-menu mb-2">
{% endif %}
        <div class="card">
            <div class="card-body">
                <a href="{% url 'resource_registration_user_guide' %}">
                    <img src="{% static 'file_info.svg' %}" alt="Info">
                    <span>Data Resource Registration Guide</span>
                </a>
            </div>
        </div>
{% if request.session.institution_for_login_session %}
        <div class="card">
            <div class="card-body">
                <a href="{% url 'resource_management:index' %}">
                    <img src="{% static 'file_upload.svg' %}" alt="File Upload">
                    <span>Manage Registrations</span>
                </a>
            </div>
        </div>
        <div class="card">
            <div class="card-body">
                <a href="{% url 'schemas' %}">
                    <img src="{% static 'data_models.svg' %}" alt="Data Models">
                    <span>Metadata Models</span>
                </a>
            </div>
        </div>
    </div>
</section>
{% else %}
    </div>
</section>
{% endif %}
{% if request.session.institution_for_login_session %}
{% comment %} {% if 'admins' in request.session.subgroup_for_login_session %}
<section>
    <h3 class="text-secondary mb-3">Memberships</h3>
    <div class="card-menu mb-2">
        <div class="card">
            <div class="card-body">
                <a href="#">
                    <img src="{% static 'data_models.svg' %}" alt="Data Models">
                    Manage Members
                </a>
            </div>
        </div>
    </div>
</section>
{% endif %} {% endcomment %}
{% endif %}
{% if request.session.is_logged_in and request.session.user_institution_subgroups %}
<hr>
<section>
    <h2 id="my-institutions-management" class="mb-3">My Institutions</h2>
    <div class="card-menu mb-2">
        <div class="card">
            <div class="card-body">
                <a href="{{ create_institution_url }}">
                    <img src="{% static 'data_models.svg' %}" alt="Data Models">
                    <span>Register a New Institution</span>
                </a>
            </div>
        </div>
        <div class="card">
            <div class="card-body">
                <a href="{% url 'list_joinable_perun_organisations' %}">
                    <img src="{% static 'data_models.svg' %}" alt="Data Models">
                    Join Another Institution
                </a>
            </div>
        </div>
    </div>
</section>
{% endif %}
{% endblock content %}
